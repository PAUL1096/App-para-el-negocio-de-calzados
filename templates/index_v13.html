{% extends "base.html" %}

{% block title %}Dashboard v1.3 - Sistema Calzado{% endblock %}

{% block content %}
<div class="page-header">
    <h1><i class="bi bi-speedometer2"></i> Dashboard Principal v1.3</h1>
    <p class="text-muted">Sistema completo con Preparación y Ventas Vinculadas</p>
</div>

<!-- Tarjetas de estadísticas -->
<div class="row g-4 mb-4">
    <div class="col-md-3">
        <div class="card stat-card">
            <div class="d-flex justify-content-between align-items-center">
                <div>
                    <div class="stat-label">Ventas Nuevas</div>
                    <div class="stat-value">{{ total_ventas_v2 }}</div>
                    <small class="text-muted">Legacy: {{ total_ventas_legacy }}</small>
                </div>
                <div class="text-primary" style="font-size: 3rem;">
                    <i class="bi bi-cart-check"></i>
                </div>
            </div>
        </div>
    </div>

    <div class="col-md-3">
        <div class="card stat-card success">
            <div class="d-flex justify-content-between align-items-center">
                <div>
                    <div class="stat-label">Ingresos (v2)</div>
                    <div class="stat-value">${{ "%.2f"|format(ingresos_v2) }}</div>
                    <small class="text-muted">{{ pares_vendidos_v2 }} pares</small>
                </div>
                <div class="text-success" style="font-size: 3rem;">
                    <i class="bi bi-cash-stack"></i>
                </div>
            </div>
        </div>
    </div>

    <div class="col-md-3">
        <div class="card stat-card warning">
            <div class="d-flex justify-content-between align-items-center">
                <div>
                    <div class="stat-label">Stock General</div>
                    <div class="stat-value">{{ stock_general }}</div>
                    <small class="text-muted">pares disponibles</small>
                </div>
                <div class="text-warning" style="font-size: 3rem;">
                    <i class="bi bi-box-seam"></i>
                </div>
            </div>
        </div>
    </div>

    <div class="col-md-3">
        <div class="card stat-card danger">
            <div class="d-flex justify-content-between align-items-center">
                <div>
                    <div class="stat-label">Preparaciones Activas</div>
                    <div class="stat-value">{{ preparaciones_activas }}</div>
                    <small class="text-muted">en venta</small>
                </div>
                <div class="text-info" style="font-size: 3rem;">
                    <i class="bi bi-bag-check"></i>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Accesos rápidos -->
<div class="row g-4 mb-4">
    <div class="col-md-12">
        <div class="card">
            <div class="card-header bg-primary text-white">
                <h5 class="mb-0"><i class="bi bi-lightning-fill"></i> Accesos Rápidos v1.3</h5>
            </div>
            <div class="card-body">
                <div class="row g-3">
                    <div class="col-md-2">
                        <a href="/preparaciones/nueva" class="btn btn-outline-success w-100">
                            <i class="bi bi-bag-plus"></i><br>
                            Nueva Preparación
                        </a>
                    </div>
                    <div class="col-md-2">
                        <a href="/preparaciones" class="btn btn-outline-primary w-100">
                            <i class="bi bi-list-check"></i><br>
                            Ver Preparaciones
                        </a>
                    </div>
                    <div class="col-md-2">
                        <a href="/ventas" class="btn btn-outline-warning w-100">
                            <i class="bi bi-cart-check"></i><br>
                            Ventas
                        </a>
                    </div>
                    <div class="col-md-2">
                        <a href="/inventario" class="btn btn-outline-info w-100">
                            <i class="bi bi-box-seam"></i><br>
                            Inventario
                        </a>
                    </div>
                    <div class="col-md-2">
                        <a href="/variantes" class="btn btn-outline-secondary w-100">
                            <i class="bi bi-palette"></i><br>
                            Variantes
                        </a>
                    </div>
                    <div class="col-md-2">
                        <a href="/pedidos_cliente" class="btn btn-outline-danger w-100">
                            <i class="bi bi-clipboard-check"></i><br>
                            Pedidos
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Ventas recientes -->
<div class="row">
    <div class="col-md-12">
        <div class="card">
            <div class="card-header bg-dark text-white">
                <h5 class="mb-0"><i class="bi bi-clock-history"></i> Ventas Recientes (Sistema Nuevo)</h5>
            </div>
            <div class="card-body p-0">
                {% if ventas_recientes %}
                <div class="table-responsive">
                    <table class="table table-hover mb-0">
                        <thead>
                            <tr>
                                <th>Código</th>
                                <th>Fecha/Hora</th>
                                <th>Cliente</th>
                                <th>Producto</th>
                                <th>Pares</th>
                                <th>Docenas</th>
                                <th>Total</th>
                                <th>Estado</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for venta in ventas_recientes %}
                            <tr>
                                <td><strong>{{ venta.codigo_venta }}</strong></td>
                                <td>
                                    {{ venta.fecha_venta }}<br>
                                    <small class="text-muted">{{ venta.hora_venta }}</small>
                                </td>
                                <td>{{ venta.cliente }}</td>
                                <td>
                                    <span class="badge bg-secondary">{{ venta.tipo }}</span><br>
                                    <small>{{ venta.cuero }} - {{ venta.color }}</small>
                                </td>
                                <td>{{ venta.cantidad_pares }}</td>
                                <td>{{ "%.1f"|format(venta.cantidad_docenas) }}</td>
                                <td><strong>${{ "%.2f"|format(venta.total_final) }}</strong></td>
                                <td>
                                    {% if venta.estado_pago == 'pagado' %}
                                        <span class="badge bg-success">Pagado</span>
                                    {% elif venta.estado_pago == 'parcial' %}
                                        <span class="badge bg-warning">Parcial</span>
                                    {% else %}
                                        <span class="badge bg-danger">Pendiente</span>
                                    {% endif %}
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
                {% else %}
                <div class="text-center p-4">
                    <p class="text-muted">No hay ventas registradas aún en el sistema nuevo</p>
                    <a href="/preparaciones/nueva" class="btn btn-primary">
                        <i class="bi bi-plus-circle"></i> Crear Primera Preparación
                    </a>
                </div>
                {% endif %}
            </div>
        </div>
    </div>
</div>
{% endblock %}
