{% extends "base.html" %}
{% block title %}Nueva Producción - Sistema Calzado{% endblock %}
{% block content %}
<div class="page-header">
    <h1><i class="bi bi-hammer"></i> Nueva Producción</h1>
    <p class="text-muted">Crear producto a partir de variante base</p>
</div>

<div class="row">
    <!-- Info de la Variante Base -->
    <div class="col-md-4">
        <div class="card mb-4">
            <div class="card-header">
                <h5><i class="bi bi-box"></i> Variante Base</h5>
            </div>
            <div class="card-body">
                <table class="table table-sm">
                    <tr>
                        <th>Código:</th>
                        <td><span class="badge bg-primary">{{ variante.codigo_interno }}</span></td>
                    </tr>
                    <tr>
                        <th>Tipo:</th>
                        <td>{{ variante.tipo_calzado }}</td>
                    </tr>
                    <tr>
                        <th>Horma:</th>
                        <td>{{ variante.tipo_horma }}</td>
                    </tr>
                    <tr>
                        <th>Segmento:</th>
                        <td>{{ variante.segmento }}</td>
                    </tr>
                </table>
                <small class="text-muted">{{ variante.descripcion }}</small>
            </div>
        </div>
    </div>

    <!-- Formulario de Producción -->
    <div class="col-md-8">
        <div class="card">
            <div class="card-header">
                <h5><i class="bi bi-clipboard-check"></i> Detalles de Producción</h5>
            </div>
            <div class="card-body">
                <form id="formProduccion">
                    <input type="hidden" name="id_variante_base" value="{{ variante.id_variante_base }}">

                    <div class="row g-3">
                        <div class="col-md-6">
                            <label class="form-label">Tipo de Cuero *</label>
                            <input type="text" class="form-control" name="cuero" required
                                   placeholder="Ej: Huante, Cuero, Sintético" list="tipos_cuero">
                            <datalist id="tipos_cuero">
                                <option value="Huante">
                                <option value="Cuero Natural">
                                <option value="Cuero Sintético">
                                <option value="Nobuck">
                                <option value="Gamuza">
                            </datalist>
                        </div>
                        <div class="col-md-6">
                            <label class="form-label">Color del Cuero *</label>
                            <input type="text" class="form-control" name="color_cuero" required
                                   placeholder="Ej: Negro, Marrón, Café" list="colores">
                            <datalist id="colores">
                                <option value="Negro">
                                <option value="Marrón">
                                <option value="Café">
                                <option value="Miel">
                                <option value="Vino">
                                <option value="Azul">
                            </datalist>
                        </div>

                        <div class="col-md-6">
                            <label class="form-label">Tipo de Suela *</label>
                            <input type="text" class="form-control" name="suela" required
                                   placeholder="Ej: Goma, Cuero, TR" list="tipos_suela">
                            <datalist id="tipos_suela">
                                <option value="Goma">
                                <option value="Cuero">
                                <option value="TR (Termoplástico)">
                                <option value="PU (Poliuretano)">
                                <option value="Eva">
                            </datalist>
                        </div>
                        <div class="col-md-6">
                            <label class="form-label">Forro</label>
                            <input type="text" class="form-control" name="forro"
                                   placeholder="Ej: Con forro alta gama, Sin forro" list="tipos_forro">
                            <datalist id="tipos_forro">
                                <option value="Sin forro">
                                <option value="Forro textil básico">
                                <option value="Forro alta gama">
                                <option value="Forro acolchado">
                            </datalist>
                        </div>

                        <div class="col-md-6">
                            <label class="form-label">Material de Plantilla *</label>
                            <input type="text" class="form-control" name="material_plantilla" required
                                   placeholder="Ej: Plantilla de cuero" list="tipos_plantilla">
                            <datalist id="tipos_plantilla">
                                <option value="Plantilla de cuero">
                                <option value="Plantilla sintética">
                                <option value="Plantilla acolchada">
                            </datalist>
                            <small class="text-muted">Distintivo de calidad del producto</small>
                        </div>

                        <div class="col-md-12">
                            <label class="form-label">Serie de Tallas *</label>
                            <input type="text" class="form-control" name="serie_tallas" required
                                   placeholder="Ej: 38(2) 39(3) 40(3) 41(2) 42(2)">
                            <small class="text-muted">Formato: Talla(cantidad) separadas por espacio</small>
                        </div>

                        <div class="col-md-6">
                            <label class="form-label">Cantidad Total de Pares *</label>
                            <input type="number" class="form-control" name="cantidad_total_pares" required min="1">
                        </div>
                        <div class="col-md-4">
                            <label class="form-label">Fecha de Producción</label>
                            <input type="date" class="form-control" name="fecha_produccion"
                                   value="{{ fecha_hoy }}">
                        </div>

                        <div class="col-md-6">
                            <label class="form-label">Costo Unitario *</label>
                            <div class="input-group">
                                <span class="input-group-text">$</span>
                                <input type="number" class="form-control" name="costo_unitario"
                                       step="0.01" required>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <label class="form-label">Precio Sugerido *</label>
                            <div class="input-group">
                                <span class="input-group-text">$</span>
                                <input type="number" class="form-control" name="precio_sugerido"
                                       step="0.01" required>
                            </div>
                        </div>

                        <div class="col-12">
                            <label class="form-label">Observaciones</label>
                            <textarea class="form-control" name="observaciones" rows="2"
                                      placeholder="Notas sobre esta producción..."></textarea>
                        </div>
                    </div>

                    <div class="mt-4 d-flex gap-2">
                        <button type="submit" class="btn btn-success">
                            <i class="bi bi-check-circle"></i> Registrar Producción
                        </button>
                        <a href="/produccion" class="btn btn-secondary">
                            Cancelar
                        </a>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>

{% endblock %}

{% block extra_js %}
<script>
document.getElementById('formProduccion').addEventListener('submit', function(e) {
    e.preventDefault();

    const formData = new FormData(this);
    const data = Object.fromEntries(formData);

    fetch('/api/productos/crear', {
        method: 'POST',
        headers: {'Content-Type': 'application/json'},
        body: JSON.stringify(data)
    })
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            alert('Producción registrada exitosamente');
            window.location.href = '/produccion';
        } else {
            alert('Error: ' + data.error);
        }
    })
    .catch(error => alert('Error: ' + error));
});
</script>
{% endblock %}
